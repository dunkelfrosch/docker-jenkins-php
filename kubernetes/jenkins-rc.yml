#
# http://kubernetes.io/docs/user-guide/deployments/
# http://kubernetes.io/docs/user-guide/replication-controller/
# http://kubernetes.io/docs/user-guide/production-pods/
#
---
  apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    name: jenkins

  spec:
    replicas: 1
    template:
      metadata:
        labels:
          app: jenkins
          version: 2.7.4.096
          tier: frontend
          track: stable

      spec:
        dnsPolicy: ClusterFirst

        containers: 
          - name: jenkins
            image: dunkelfrosch/docker-jenkins-php
            imagePullPolicy: IfNotPresent

            #resources:
            #  limits:
            #    cpu: 2
            #    memory: 2Gi
            #  requests:
            #    cpu: 1
            #    memory: 1Gi

            securityContext:
              privileged: true

            ports:
              - containerPort: 8080
              - containerPort: 50000

            volumeMounts:
              - name: jenkins-data
                mountPath: /var/jenkins_home

            livenessProbe:
              initialDelaySeconds: 60
              timeoutSeconds: 5
              httpGet:
                path: /login
                port: 8080

        volumes:
          - name: jenkins-data
            gcePersistentDisk:
              pdName: kubernetes-jenkins
              fsType: ext4
